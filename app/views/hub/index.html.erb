<section class="bg-white d-flex justify-content-center align-items-start pb-4 pt-5">
    <h1 class="text-center fw-semi-bold"><%= t('welcome_to_hub') %>, <%= current_user.username %>!</h1> 
</section>
    <section id="events-section" class="bg-white d-flex justify-content-center">
        <div class="container-xl my-4 border-style">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="py-3 mb-0"><%= t('upcoming_events') %></h2>
                <div>
                    <% if current_user.access_level == 'admin' %>
                        <button class="btn btn-outline-primary btn-hub me-2" data-bs-toggle="modal" data-bs-target="#addEventModal">add event</button>
                    <% end %>
                    <button class="btn btn-outline-primary btn-hub" data-bs-toggle="modal" data-bs-target="#viewEventModal">view more</button>
                </div>
            </div>
            
            <div class="card cc-green-bg border-0 mb-3 p-2">
                <% if @upcoming_events.any? %>
                    <% @upcoming_events.each do |event| %>
                        <div class="card w-100 my-1 bg-white ps-3 pe-1 info-box border-0">
                            <div class="card-body d-flex justify-content-between align-items-center py-2">
                                <div>
                                    <h5 class="card-title fs-5 mb-0"><%= event.event_type.titleize %></h5>
                                    <p class="card-text text-muted mb-0"><%= event.notes %></p>
                                    <p class="card-text text-muted mb-0"><%= event.location %></p>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-secondary-subtle text-dark-emphasis fs-6 me-3">
                                        <%= event.datetime.strftime("%a, %b %d, %Y - %I:%M %p") %>
                                    </span>
                                    <% if current_user.access_level == 'admin' %>
                                        <div class="d-flex">
                                            <button class="btn btn-outline-primary btn-sm me-2" data-bs-toggle="modal" data-bs-target="#editEventModal<%= event.id %>" aria-label="Edit event">
                                                <i class="bi bi-pen"></i>
                                            </button>
                                            <%= button_to event_path(event, locale: I18n.locale), method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "btn btn-outline-danger btn-sm" do %>
                                                <i class="bi bi-trash3"></i>
                                            <% end %>
                                        </div>
                                    <% end %>
                                </div>
                            </div>
                        </div>
                    <% end %>
                <% else %>
                    <div class="card w-100 my-1 bg-white ps-3 pe-1 info-box border-0">
                        <div class="card-body text-center">
                            <h5 class="card-title fs-5 text-muted">No upcoming events.</h5>
                        </div>
                    </div>
                <% end %>
            </div>
        </div>
    </section>

   
    <section id="finances-section" class="bg-white d-flex justify-content-center">
        <div class="container-xl my-4 border-style">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="pt-3 mb-2"><%= t('finances') %></h2>
                <div class="d-flex">
                    <% if current_user.access_level == 'admin' %>
                        <button class="btn btn-outline-primary btn-hub me-2" onclick="window.location.href='<%= club_finances_path(locale: I18n.locale) %>'">
                            club finances
                        </button>
                    <% end %>
                    <button class="btn btn-outline-primary btn-hub" data-bs-toggle="modal" data-bs-target="#addPaymentModal">make payment</button>
                </div>
            </div>
            <div class="row pt-0 mt-1">
                <div class="col-12 px-3 ">
                    <div class="card cc-green-bg border-0 mb-3 py-3 ps-4 pe-2">
                        <div class="row g-1">
                            <div class="col-4">
                                <div class="bg-white rounded info-box h-100 p-4 d-flex flex-column justify-content-center">
                                    <h5 class="card-title fs-4 mb-2">balance</h5>
                                    <p class="text-muted mb-0"><%= current_user.balance %></p>
                                </div>
                            </div>
                            <div class="col-8">
                                <div class="bg-white rounded info-box h-100 p-4 d-flex flex-column justify-content-center">
                                    <h5 class="card-title fs-4 mb-2">transactions</h5>
                                        <% payment_sent_transactions = @recent_transactions.select { |transaction| transaction.transaction_type == 'payment_sent' } %>
                                        <% if payment_sent_transactions.any? %>
                                <div style="max-height: 200px; overflow-y: auto;">
                                    <% payment_sent_transactions.each do |transaction| %>
                                        <div class="d-flex justify-content-between align-items-center mb-2 small border-bottom pb-1">
                                            <div>
                                                <div class="fw-semibold"><%= transaction.transaction_description %></div>
                                                <div class="text-muted small"><%= transaction.notes if transaction.notes.present? %></div>
                                            </div>
                                            <div class="text-end">
                                                <div class="text-danger">
                                                    -<%= transaction.amount.abs %>
                                                </div>
                                                <div class="text-muted small"><%= transaction.created_at.strftime('%m/%d %H:%M') %></div>
                                            </div>
                                            </div>
                                            <% end %>
                                        </div>
                                    <% else %>
                                        <p class="text-muted mb-0">No payments sent yet</p>
                                    <% end %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

     <section id="players-section" class="bg-white d-flex justify-content-center">
        <div class="container-xl my-4 border-style">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="py-3 mb-0"><%= t('roster') %></h2>
                <div>
                    <% if current_user.access_level == 'admin' %>
                        <button class="btn btn-outline-primary btn-hub me-2" data-bs-toggle="modal" data-bs-target="#addPlayerModal">add player</button>
                    <% end %>
                    <button class="btn btn-outline-primary btn-hub" data-bs-toggle="modal" data-bs-target="#editPlayerModalSelf<%= current_user.id %>">edit info</button>
                    <button class="btn btn-outline-primary btn-hub" data-bs-toggle="modal" data-bs-target="#viewPlayerModal">view more</button>
                </div>
            </div>
            
            <div class="card cc-green-bg border-0 mb-3 p-2">
                <% if @roster_players.any? %>
                    <% @roster_players.each do |player| %>
                        <div class="card w-100 my-1 bg-white ps-3 pe-1 info-box border-0">
                            <div class="card-body d-flex justify-content-between align-items-center py-2">
                                <div>
                                    <% if player.access_level == 'player' && current_user.access_level == 'admin' %>
                                        <%= button_to promote_user_path(player, locale: I18n.locale), method: :patch, class: "btn btn-admin", title: "Promote to admin" do %>
                                            <i class="bi bi-bookmark-plus"></i>
                                        <% end %>
                                    <% elsif player.access_level == 'admin' && current_user.access_level == 'admin' %>
                                        <%= button_to demote_user_path(player, locale: I18n.locale), method: :patch, class: "btn bg-white btn-warning", title: "Demote to player" do %>
                                            <i class="bi bg-white bi-bookmark-check"></i>
                                        <% end %>
                                        
                                    <% end %>
                                    <h5 class="card-title fs-5 mb-0">
                                        <%= player.username.titleize %>
                                        <% if player.access_level == 'admin' %>
                                            <span class="badge bg-primary ms-2">admin</span>
                                        <% else %>
                                            <span class="badge bg-secondary ms-2">player</span>
                                        <% end %>
                                    </h5>
                                    <p class="card-text text-muted mb-0">
                                        <%= player.position %>
                                        <% if player.car %>
                                            <i class="bi bi-car-front-fill"></i>
                                        <% end %>
                                    </p>
                                    <% if current_user.access_level == 'admin' %>
                                        <p class="card-text text-muted mb-0">balance: <%= player.balance %></p>
                                    <% end %>
                                </div>
                                
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-secondary-subtle text-dark-emphasis fs-6 me-3">
                                        <%= player.location %>
                                    </span>
                                    <% if current_user.access_level == 'admin' %>
                                        <div class="d-flex">
                                            <button class="btn btn-outline-primary btn-sm me-2" 
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#editPlayerModal<%= player.id %>">
                                                <i class="bi bi-pen"></i>
                                            </button>
                                            <%= button_to user_path(player, locale: I18n.locale), method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "btn btn-outline-danger btn-sm" do %>
                                                <i class="bi bi-trash3"></i>
                                            <% end %>
                                        </div>
                                    <% end %>
                                </div>
                            </div>
                        </div>
                    <% end %>
                <% else %>
                    <div class="card w-100 my-1 bg-white ps-3 pe-1 info-box border-0">
                        <div class="card-body text-center">
                            <h5 class="card-title fs-5 text-muted">No players on the roster.</h5>
                        </div>
                    </div>
                <% end %>
            </div>
        </div>
    </section>

    <%= render 'hub/modals/user_add' %>
    <%= render 'hub/modals/user_edit_self' %>
    <%= render 'hub/modals/user_edit_user' %>
    <%= render 'hub/modals/user_view' %>
    <%= render 'hub/modals/event_view' %>
    <%= render 'hub/modals/event_edit' %>
    <%= render 'hub/modals/event_add' %>
    <%= render 'hub/modals/finance' %>
